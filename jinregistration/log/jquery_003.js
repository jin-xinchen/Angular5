(function($){$.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:'<small>Loading...</small>',padding:0,nextSelector:'a:last',contentSelector:'',pagingSelector:'',callback:!1}};var jScroll=function($e,options){var _data=$e.data('jscroll'),_userOptions=(typeof options==='function')?{callback:options}:options,_options=$.extend({},$.jscroll.defaults,_userOptions,_data||{}),_isWindow=($e.css('overflow-y')==='visible'),_$next=$e.find(_options.nextSelector).first(),_$window=$(window),_$body=$('body'),_$scroll=_isWindow?_$window:$e,_nextHref=$.trim(_$next.attr('href')+' '+_options.contentSelector);$e.data('jscroll',$.extend({},_data,{initialized:!0,waiting:!1,nextHref:_nextHref}));_wrapInnerContent();_preloadImage();_setBindings();function _preloadImage(){var src=$(_options.loadingHtml).filter('img').attr('src');if(src){var image=new Image();image.src=src}}
function _wrapInnerContent(){if(!$e.find('.jscroll-inner').length){$e.contents().wrapAll('<div class="jscroll-inner" />')}}
function _nextWrap($next){if(_options.pagingSelector){var $parent=$next.closest(_options.pagingSelector).hide()}else{var $parent=$next.parent().not('.jscroll-inner,.jscroll-added').addClass('jscroll-next-parent').hide();if(!$parent.length){$next.wrap('<div class="jscroll-next-parent" />').parent().hide()}}}
function _destroy(){return _$scroll.unbind('.jscroll').removeData('jscroll').find('.jscroll-inner').children().unwrap().filter('.jscroll-added').children().unwrap()}
function _observe(){_wrapInnerContent();var $inner=$e.find('div.jscroll-inner').first(),data=$e.data('jscroll'),borderTopWidth=parseInt($e.css('borderTopWidth')),borderTopWidthInt=isNaN(borderTopWidth)?0:borderTopWidth,iContainerTop=parseInt($e.css('paddingTop'))+borderTopWidthInt,iTopHeight=_isWindow?_$scroll.scrollTop():$e.offset().top,innerTop=$inner.length?$inner.offset().top:0,iTotalHeight=Math.ceil(iTopHeight-innerTop+_$scroll.height()+iContainerTop);if(!data.waiting&&iTotalHeight+_options.padding>=$inner.outerHeight()){_debug('info','jScroll:',$inner.outerHeight()-iTotalHeight,'from bottom. Loading next request...');return _load()}}
function _checkNextHref(data){data=data||$e.data('jscroll');if(!data||!data.nextHref){_debug('warn','jScroll: nextSelector not found - destroying');_destroy();return!1}else{_setBindings();return!0}}
function _setBindings(){var $next=$e.find(_options.nextSelector).first();if(_options.autoTrigger&&(_options.autoTriggerUntil===!1||_options.autoTriggerUntil>0)){_nextWrap($next);if(_$body.height()<=_$window.height()){_observe()}
_$scroll.unbind('.jscroll').bind('scroll.jscroll',function(){return _observe()});if(_options.autoTriggerUntil>0){_options.autoTriggerUntil--}}else{_$scroll.unbind('.jscroll');$next.bind('click.jscroll',function(){_nextWrap($next);_load();return!1})}}
function _load(){var $inner=$e.find('div.jscroll-inner').first(),datan=$e.data('jscroll');datan.waiting=!0;$inner.append('<div class="jscroll-added" />').children('.jscroll-added').last().html('<div class="jscroll-loading">'+_options.loadingHtml+'</div>');var element;var offset=$('.blog-item').length;if($('article.sticky').length){offset=offset-$('article.sticky').length}
element='';var type_Style='';if(styleblogjs=="grid"){type_Style='&type_Style=grid'}else{type_Style='&type_Style=classic'}
$.ajax({type:"POST",url:ajaxurl,data:"action=blog_load_more&offset="+offset+type_Style,success:function(data){if(data.indexOf("##nopost##")>=0){$('.content-loader,.content-loader,.fullwd,.jscroll-loading').remove();$('.footer').fadeIn(1000)}else{element=$(data).hide().fadeIn(1000);return $e.animate({scrollTop:$inner.outerHeight()},0,function(){$inner.find('div.jscroll-added').last().html(element);var $next=$(this).find(_options.nextSelector).first();datan.waiting=!1;datan.nextHref=$next.attr('href')?$.trim($next.attr('href')+' '+_options.contentSelector):!1;$('.jscroll-next-parent',$e).remove();_checkNextHref();if(_options.callback){_options.callback.call(this)}
_debug('dir',datan)})}}})}
function _debug(m){if(_options.debug&&typeof console==='object'&&(typeof m==='object'||typeof console[m]==='function')){if(typeof m==='object'){var args=[];for(var sMethod in m){if(typeof console[sMethod]==='function'){args=(m[sMethod].length)?m[sMethod]:[m[sMethod]];console[sMethod].apply(console,args)}else{console.log.apply(console,args)}}}else{console[m].apply(console,Array.prototype.slice.call(arguments,1))}}}
$.extend($e.jscroll,{destroy:_destroy});return $e};$.fn.jscroll=function(m){return this.each(function(){var $this=$(this),data=$this.data('jscroll');if(data&&data.initialized)return;var jscroll=new jScroll($this,m)})}})(jQuery)